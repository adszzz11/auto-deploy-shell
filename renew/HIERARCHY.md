# Module Hierarchy

## ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: User Interface                                 â”‚
â”‚                                                          â”‚
â”‚  main.sh                                                 â”‚
â”‚  - ì‚¬ìš©ì ì§„ì…ì                                           â”‚
â”‚  - 4ê°œ ëª…ë ¹ì–´: deploy, rollback, status, validate         â”‚
â”‚  - multi_deployë§Œ í˜¸ì¶œ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Orchestration                                  â”‚
â”‚                                                          â”‚
â”‚  multi_deploy/                                           â”‚
â”‚  - ë‹¤ì¤‘ ì¸ìŠ¤í„´ìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜                             â”‚
â”‚  - deploy, rollback ëª¨ë“ˆ í˜¸ì¶œ                            â”‚
â”‚  - ìŠ¤ì¼€ì¼ ì—…/ë‹¤ìš´ ê´€ë¦¬                                    â”‚
â”‚  - ìë™ ë¡¤ë°± ì²˜ë¦¬                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚
             v                    v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3:           â”‚  â”‚ Layer 3:           â”‚
â”‚ Core Operations    â”‚  â”‚ Core Operations    â”‚
â”‚                    â”‚  â”‚                    â”‚
â”‚  deploy/           â”‚  â”‚  rollback/         â”‚
â”‚  - ë‹¨ì¼ ë°°í¬       â”‚  â”‚  - ë‹¨ì¼ ë¡¤ë°±       â”‚
â”‚  - 12ë‹¨ê³„ ì‹¤í–‰     â”‚  â”‚  - 10ë‹¨ê³„ ì‹¤í–‰     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Support Services                               â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  nginx   â”‚  â”‚link_jar  â”‚  â”‚ run_app  â”‚  â”‚   test   â”‚â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ instance â”‚â”‚
â”‚  â”‚ì—…ìŠ¤íŠ¸ë¦¼  â”‚  â”‚JAR ë§í¬  â”‚  â”‚í”„ë¡œì„¸ìŠ¤  â”‚  â”‚í—¬ìŠ¤ì²´í¬  â”‚â”‚
â”‚  â”‚  ì œì–´    â”‚  â”‚  ê´€ë¦¬    â”‚  â”‚  ê´€ë¦¬    â”‚  â”‚         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì‚¬ìš©ì ê´€ì 

### ì¼ë°˜ ì‚¬ìš©ì (95%)

**ì‚¬ìš© ë„êµ¬**: `main.sh`ë§Œ + `base.env` í•˜ë‚˜

```bash
# í™˜ê²½ ì„¤ì •
cp base.env myapp.env
vi myapp.env  # í•„ìˆ˜ ì„¤ì •ë§Œ ìˆ˜ì •

# ë°°í¬
./main.sh deploy 5 myapp.env

# ìƒíƒœ í™•ì¸
./main.sh status myapp.env

# ë¡¤ë°±
./main.sh rollback myapp.env
```

**íŠ¹ì§•**:
- ê°„ë‹¨í•œ 4ê°œ ëª…ë ¹ì–´
- í•˜ë‚˜ì˜ ì„¤ì • íŒŒì¼ë§Œ ê´€ë¦¬ (base.env í…œí”Œë¦¿ ì‚¬ìš©)
- ë‚´ë¶€ êµ¬ì¡° ëª°ë¼ë„ ì‚¬ìš© ê°€ëŠ¥
- ì•ˆì „í•œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

---

### ê³ ê¸‰ ì‚¬ìš©ì (5%)

**ì‚¬ìš© ë„êµ¬**: ëª¨ë“ˆ ì§ì ‘ í˜¸ì¶œ (base.env íŒŒì¼ì€ ë™ì¼í•˜ê²Œ ì‚¬ìš©)

```bash
# ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ë°°í¬ (Layer 2 í†µí•´ì„œ)
./multi_deploy/multi_deploy_control.sh deploy-single 0 myapp.env

# ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ë¡¤ë°± (Layer 2 í†µí•´ì„œ)
./multi_deploy/multi_deploy_control.sh rollback-single 0 myapp.env

# ì„¸ë¶€ í…ŒìŠ¤íŠ¸ (Layer 4 ì§ì ‘ í˜¸ì¶œ)
./test_instance/test_instance_control.sh full 8080 myapp.env

# Nginx ìˆ˜ë™ ì œì–´ (Layer 4 ì§ì ‘ í˜¸ì¶œ)
./nginx/nginx_control.sh down 8080 /etc/nginx/conf.d/upstream.conf
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ë””ë²„ê¹…
- ë¶€ë¶„ ì‹¤íŒ¨ ë³µêµ¬
- ì»¤ìŠ¤í„°ë§ˆì´ì§•
- ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

---

## í˜¸ì¶œ íë¦„

### ë°°í¬ íë¦„

```
User
  â”‚
  â””â”€> ./main.sh deploy 5 myapp.env
        â”‚
        â””â”€> multi_deploy_control.sh deploy 5 myapp.env
              â”‚
              â”œâ”€> deploy_control.sh deploy 0 myapp.env
              â”‚     â”‚
              â”‚     â”œâ”€> nginx_control.sh down 8080
              â”‚     â”œâ”€> link_jar_control.sh link
              â”‚     â”œâ”€> run_app_control.sh restart 8080
              â”‚     â”œâ”€> test_instance_control.sh test 8080
              â”‚     â””â”€> nginx_control.sh up 8080
              â”‚
              â”œâ”€> deploy_control.sh deploy 1 app.env
              â”‚     â””â”€> (ë™ì¼í•œ íë¦„)
              â”‚
              â”œâ”€> deploy_control.sh deploy 2 app.env
              â”‚     â””â”€> (ë™ì¼í•œ íë¦„)
              â”‚
              â””â”€> ... (ë‚˜ë¨¸ì§€ ì¸ìŠ¤í„´ìŠ¤)
```

### ë¡¤ë°± íë¦„

```
User
  â”‚
  â””â”€> ./main.sh rollback app.env
        â”‚
        â””â”€> multi_deploy_control.sh rollback app.env
              â”‚
              â”œâ”€> rollback_control.sh rollback 2 app.env
              â”‚     â”‚
              â”‚     â”œâ”€> nginx_control.sh down 8082
              â”‚     â”œâ”€> (JAR ë³µì›)
              â”‚     â”œâ”€> run_app_control.sh restart 8082
              â”‚     â””â”€> nginx_control.sh up 8082
              â”‚
              â”œâ”€> rollback_control.sh rollback 1 app.env
              â”‚     â””â”€> (ë™ì¼í•œ íë¦„)
              â”‚
              â””â”€> rollback_control.sh rollback 0 app.env
                    â””â”€> (ë™ì¼í•œ íë¦„)
```

---

## ê³„ì¸µ ê°„ í†µì‹ 

### í†µì‹  ë°©ì‹

| ê³„ì¸µ | í†µì‹  ë°©ë²• | ë°ì´í„° í˜•ì‹ |
|------|----------|------------|
| Layer 1 â†’ 2 | CLI í˜¸ì¶œ | ëª…ë ¹ì–´ ì¸ì |
| Layer 2 â†’ 3 | CLI í˜¸ì¶œ | ëª…ë ¹ì–´ ì¸ì |
| Layer 3 â†’ 4 | CLI í˜¸ì¶œ | ëª…ë ¹ì–´ ì¸ì |
| ëª¨ë“  ê³„ì¸µ | í™˜ê²½ ë³€ìˆ˜ | `export VAR=value` |
| ëª¨ë“  ê³„ì¸µ | íŒŒì¼ ì‹œìŠ¤í…œ | ì‹¬ë³¼ë¦­ ë§í¬, PID íŒŒì¼ |

### ë°˜í™˜ê°’

- **0**: ì„±ê³µ
- **1**: ì‹¤íŒ¨
- **124**: íƒ€ì„ì•„ì›ƒ

### ì¶œë ¥ ì±„ë„

- **stdout**: ì •ë³´, ì„±ê³µ ë©”ì‹œì§€
- **stderr**: ì—ëŸ¬, ê²½ê³  ë©”ì‹œì§€

---

## ì˜ì¡´ì„± ê·œì¹™

### âœ… í—ˆìš©

```bash
# ìƒìœ„ â†’ í•˜ìœ„ ê³„ì¸µ í˜¸ì¶œ
main.sh â†’ multi_deploy
multi_deploy â†’ deploy
multi_deploy â†’ rollback
deploy â†’ nginx, link_jar, run_app, test_instance
rollback â†’ nginx, run_app
```

### âŒ ê¸ˆì§€

```bash
# ê³„ì¸µ ìš°íšŒ ê¸ˆì§€
main.sh â†’ deploy (X)
main.sh â†’ nginx (X)

# í•˜ìœ„ â†’ ìƒìœ„ í˜¸ì¶œ ê¸ˆì§€
deploy â†’ multi_deploy (X)
nginx â†’ deploy (X)

# ë™ì¼ ê³„ì¸µ ê°„ í˜¸ì¶œ ê¸ˆì§€
deploy â†’ rollback (X)
nginx â†’ link_jar (X)
```

### ğŸ”„ ì˜ˆì™¸: ìˆœí™˜ ì°¸ì¡° ë°©ì§€

```bash
# multi_deployê°€ deploy í˜¸ì¶œ
# deploy ì‹¤íŒ¨ ì‹œ multi_deployê°€ rollback í˜¸ì¶œ
# ì´ëŠ” ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì—­í• ë¡œ í—ˆìš©ë¨

multi_deploy
  â”œâ”€> deploy (ì„±ê³µ)
  â””â”€> rollback (ì‹¤íŒ¨ ì‹œ)
```

---

## ëª¨ë“ˆ ë…ë¦½ì„±

### ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥

ëª¨ë“  `*_control.sh`ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥:

```bash
# âœ… ê°€ëŠ¥
./deploy/deploy_control.sh deploy 0 app.env
./nginx/nginx_control.sh up 8080 upstream.conf
./test_instance/test_instance_control.sh test 8080

# âœ… ê°€ëŠ¥ (í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì • ì „ë‹¬)
export SERVICE_NAME=myapp
export BASE_PORT=808
./run_app/run_app_control.sh start 8080
```

### ëª¨ë“ˆ êµì²´ ê°€ëŠ¥

ê° ëª¨ë“ˆì€ ì¸í„°í˜ì´ìŠ¤ë§Œ ë§ìœ¼ë©´ êµì²´ ê°€ëŠ¥:

```bash
# nginx ëª¨ë“ˆì„ HAProxyë¡œ êµì²´ ê°€ëŠ¥
# - nginx_control.shì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
# - up, down ëª…ë ¹ì–´ ì§€ì›
./haproxy/haproxy_control.sh up 8080 haproxy.cfg
```

---

## í™•ì¥ í¬ì¸íŠ¸

### 1. ìƒˆ Layer 4 ëª¨ë“ˆ ì¶”ê°€

```bash
# ì˜ˆ: ëª¨ë‹ˆí„°ë§ ëª¨ë“ˆ
renew/monitoring/
â”œâ”€â”€ monitoring_control.sh
â”œâ”€â”€ monitoring.env
â””â”€â”€ func/
    â”œâ”€â”€ send_metric.sh
    â””â”€â”€ send_alert.sh

# deployì—ì„œ í˜¸ì¶œ
"${script_dir}/../monitoring/monitoring_control.sh" metric deployed "$instance"
```

### 2. Layer 3 ëª¨ë“ˆ ì¶”ê°€

```bash
# ì˜ˆ: ë¸”ë£¨-ê·¸ë¦° ë°°í¬ ëª¨ë“ˆ
renew/blue_green/
â”œâ”€â”€ blue_green_control.sh
â””â”€â”€ func/
    â”œâ”€â”€ switch_traffic.sh
    â””â”€â”€ validate_deployment.sh

# multi_deployì—ì„œ í˜¸ì¶œ ê°€ëŠ¥
```

### 3. Layer 2 í™•ì¥

```bash
# ì˜ˆ: ì¹´ë‚˜ë¦¬ ë°°í¬ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
renew/canary_deploy/
â”œâ”€â”€ canary_deploy_control.sh
â””â”€â”€ func/
    â”œâ”€â”€ gradual_rollout.sh
    â””â”€â”€ traffic_split.sh

# main.shì—ì„œ ìƒˆ ëª…ë ¹ì–´ ì¶”ê°€
case "$command" in
    canary)
        ./canary_deploy/canary_deploy_control.sh "$@"
        ;;
esac
```

---

## ì„¤ê³„ ì›ì¹™

### 1. ë‹¨ì¼ ì±…ì„ (Single Responsibility)
- ê° ëª¨ë“ˆì€ í•˜ë‚˜ì˜ ëª…í™•í•œ ì±…ì„
- main.sh: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤
- multi_deploy: ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- deploy: ë°°í¬ ì‹¤í–‰
- nginx: ì—…ìŠ¤íŠ¸ë¦¼ ì œì–´

### 2. ê³„ì¸µ ë¶„ë¦¬ (Layered Architecture)
- ìƒìœ„ ê³„ì¸µì€ í•˜ìœ„ ê³„ì¸µ í˜¸ì¶œë§Œ ê°€ëŠ¥
- ê³„ì¸µ ìš°íšŒ ê¸ˆì§€
- ëª…í™•í•œ ì±…ì„ ê²½ê³„

### 3. ëŠìŠ¨í•œ ê²°í•© (Loose Coupling)
- CLI ê¸°ë°˜ í†µì‹ 
- í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì • ê³µìœ 
- íŒŒì¼ ì‹œìŠ¤í…œìœ¼ë¡œ ìƒíƒœ ê³µìœ 

### 4. ë†’ì€ ì‘ì§‘ë„ (High Cohesion)
- ê´€ë ¨ ê¸°ëŠ¥ì„ í•œ ëª¨ë“ˆì— ì§‘ì¤‘
- func/ ë””ë ‰í„°ë¦¬ë¡œ ì„¸ë¶€ ê¸°ëŠ¥ ë¶„ë¦¬

### 5. ê°œë°©-íì‡„ ì›ì¹™ (Open-Closed)
- í™•ì¥ì—ëŠ” ì—´ë ¤ìˆìŒ (ìƒˆ ëª¨ë“ˆ ì¶”ê°€)
- ìˆ˜ì •ì—ëŠ” ë‹«í˜€ìˆìŒ (ê¸°ì¡´ ëª¨ë“ˆ ë³€ê²½ ìµœì†Œí™”)

---

**Version**: 1.0
**Last Updated**: 2025-10-04
