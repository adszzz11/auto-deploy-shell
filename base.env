# base.env - Auto Deploy Shell Configuration
#
# 이 파일은 사용자가 관리하는 유일한 환경 설정 파일입니다.
# 각 모듈의 .env 파일은 기본값만 제공하며, 이 파일이 모든 설정을 오버라이드합니다.
#
# 사용법: ./main.sh deploy <count> base.env

# ============================================================
# 필수 설정 (Required)
# ============================================================

# 서비스 이름
export SERVICE_NAME="service_name"

# 기본 포트 (인스턴스 번호가 뒤에 붙음: 808 + 0 = 8080)
export BASE_PORT="808"

# JAR 파일이 있는 디렉터리
export JAR_TRUNK_DIR="/home/service/${SERVICE_NAME}/jar_trunk"

# 서비스 기본 디렉터리
export SERVICE_BASE_DIR="/home/service"

# Nginx upstream 설정 파일 경로
export UPSTREAM_CONF="/etc/nginx/conf.d/upstream.conf"

# ============================================================
# 선택 설정 (Optional)
# ============================================================

# 로그 디렉터리
export LOG_BASE_DIR="/home/system/logs"

# Spring Boot 실행 옵션
export JAVA_OPTS="--spring.profiles.active=prod"

# 애플리케이션 실행 모드 (restart, start, stop)
export APP_MODE="restart"

# ============================================================
# Multi Deploy 설정
# ============================================================

# 인스턴스 범위
export MULTI_DEPLOY_MIN_INSTANCES=2
export MULTI_DEPLOY_MAX_INSTANCES=10

# 배포 전략
export MULTI_DEPLOY_AUTO_ROLLBACK=true
export MULTI_DEPLOY_WAIT_BETWEEN_DEPLOYS=2
export MULTI_DEPLOY_STABILIZATION_WAIT=5

# ============================================================
# Deploy 설정
# ============================================================

export DEPLOY_BACKUP_JAR=true
export DEPLOY_NGINX_CONTROL=true

# ============================================================
# Test Instance 설정
# ============================================================

# 테스트 활성화
export TEST_INSTANCE_ENABLED=true

# 테스트 모드 (simple, full, custom)
export TEST_MODE=simple

# HTTP 테스트
export TEST_HTTP_ENDPOINT="/actuator/health"
export TEST_EXPECTED_STATUS=200

# 재시도 설정
export TEST_RETRY_COUNT=5
export TEST_RETRY_DELAY=3
export TEST_WARMUP_WAIT=10
export TEST_TIMEOUT=30

# Full 모드 옵션 (TEST_MODE=full 일 때)
# export TEST_TCP_ENABLED=true
# export TEST_RESPONSE_TIME_ENABLED=true
# export TEST_MAX_RESPONSE_TIME=1000

# Custom 모드 옵션 (TEST_MODE=custom 일 때)
# export TEST_CUSTOM_SCRIPT="./my_test.sh"

# ============================================================
# Rollback 설정
# ============================================================

export ROLLBACK_VERIFY_BACKUP=true
export ROLLBACK_RESTART_APP=true
export ROLLBACK_NGINX_UP_AFTER=true

# ============================================================
# Nginx 설정
# ============================================================

export NGINX_TEST_CONFIG=true
export NGINX_BACKUP_CONFIG=true

# ============================================================
# 참고사항
# ============================================================
#
# 포트 체계:
#   BASE_PORT=808, Instance 0 → Port 8080
#   BASE_PORT=808, Instance 1 → Port 8081
#   ...
#
# 디렉터리 구조:
#   ${SERVICE_BASE_DIR}/${SERVICE_NAME}/
#   ├── jar_trunk/           # JAR 파일들
#   └── instances/
#       ├── 0/
#       │   ├── current.jar      (symlink)
#       │   ├── current.jar.bak  (backup)
#       │   └── logs/            (symlink)
#       ├── 1/
#       └── 2/
#
# 필수 환경 변수:
#   SERVICE_NAME, BASE_PORT, JAR_TRUNK_DIR,
#   SERVICE_BASE_DIR, UPSTREAM_CONF
#
# 사용 예시:
#   1. 이 파일 복사: cp base.env myapp.env
#   2. 설정 수정: vi myapp.env
#   3. 배포 실행: ./main.sh deploy 3 myapp.env
#
