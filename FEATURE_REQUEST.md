# 기능 추가 요청 템플릿

Claude에게 기능 추가를 요청할 때 사용하는 템플릿입니다.

---

## 📋 필수 정보만 작성하세요

```yaml
# 기능 이름
기능: [한 줄로 설명]

# 무엇을 받아서
입력:
  - 파라미터1: [설명]
  - 파라미터2: [설명] (선택사항)

# 무엇을 하고
동작:
  - [단계1]
  - [단계2]

# 무엇을 반환하는지
출력:
  - [결과물]

# 언제 실패하는지
실패조건:
  - [조건1]
  - [조건2]
```

---

## 📝 예시 1: 간단한 기능

```yaml
기능: JAR 파일 백업

입력:
  - jar_file: 백업할 JAR 파일 경로
  - backup_dir: 백업 저장 디렉터리 (선택, 기본값: /tmp/backups)

동작:
  - JAR 파일이 존재하는지 확인
  - backup_dir 디렉터리 생성
  - JAR 파일을 backup_dir에 복사
  - 타임스탬프를 파일명에 추가

출력:
  - 백업 파일 경로 출력
  - 성공 메시지

실패조건:
  - JAR 파일이 없으면 에러
  - 디렉터리 생성 실패하면 에러
  - 복사 실패하면 에러
```

---

## 📝 예시 2: 여러 단계가 있는 기능

```yaml
기능: 인스턴스 헬스체크 with 재시도

입력:
  - port: 포트 번호
  - endpoint: 헬스체크 엔드포인트 (선택, 기본값: /actuator/health)
  - max_retry: 최대 재시도 횟수 (선택, 기본값: 3)
  - retry_delay: 재시도 간격 초 (선택, 기본값: 5)

동작:
  - curl로 HTTP 요청
  - 응답 코드가 200이면 성공
  - 실패하면 retry_delay 만큼 대기 후 재시도
  - max_retry 만큼 반복

출력:
  - 성공 시: "✅ Healthy" 메시지
  - 실패 시: "❌ Unhealthy after N retries" 메시지

실패조건:
  - 포트가 잘못되면 에러
  - max_retry 초과하면 에러
  - curl 타임아웃 (10초)
```

---

## 📝 예시 3: 기존 모듈과 통합

```yaml
기능: 배포 전 디스크 공간 체크 추가

위치: deploy_control.sh의 execute_deploy 함수

추가할 곳: JAR 백업 전 (6단계 이전)

입력:
  - instance_dir: 인스턴스 디렉터리
  - required_space: 필요한 공간 MB (선택, 기본값: 500)

동작:
  - df로 디스크 사용량 확인
  - 남은 공간이 required_space보다 큰지 확인
  - 부족하면 경고 메시지 출력

출력:
  - 충분하면: "[INFO] Disk space OK: XXX MB available"
  - 부족하면: "[ERROR] Insufficient disk space: XXX MB available, XXX MB required"

실패조건:
  - 디스크 공간 부족하면 배포 중단
```

---

## 🎯 작성 가이드

### ✅ 좋은 요청 (이렇게 작성하세요)

```yaml
기능: 프로세스 PID 파일 생성

입력:
  - pid: 프로세스 ID
  - pid_file: PID 파일 경로

동작:
  - 기존 PID 파일 있으면 삭제
  - PID를 파일에 저장

출력:
  - "[SUCCESS] PID saved to {파일경로}"

실패조건:
  - PID가 0이면 에러
  - 파일 쓰기 실패하면 에러
```

### ❌ 나쁜 요청 (이런 식으로 작성하지 마세요)

```
PID 파일 만들어줘. 그냥 잘 되게 해줘.
```

이유: 무엇을 받고, 무엇을 하고, 무엇을 반환하는지 불명확함

---

## 🚀 빠른 양식 (복사해서 사용)

```yaml
기능:

입력:
  -

동작:
  -

출력:
  -

실패조건:
  -
```

---

## 💡 팁

### 1. 입력 파라미터
- **필수 파라미터**: 반드시 필요한 값
- **선택 파라미터**: `(선택, 기본값: XXX)` 형식으로 표시

### 2. 동작 설명
- 순서대로 나열
- 간단하게 한 줄로
- 복잡하면 여러 단계로 나누기

### 3. 출력
- 로그 메시지 예시 포함하면 좋음
- 반환값이 있으면 명시

### 4. 실패조건
- 언제 에러를 내야 하는지
- 어떤 검증이 필요한지

---

## 🔗 통합 요청 시

기존 모듈에 추가할 때는 이렇게:

```yaml
기능: [기능명]

통합위치: deploy_control.sh > execute_deploy 함수

추가위치: [어느 단계 이전/이후]

입력: [...]
동작: [...]
출력: [...]
실패조건: [...]
```

---

## 📞 요청 예시 모음

### 파일 관련

```yaml
기능: 디렉터리 크기 계산

입력:
  - directory: 디렉터리 경로

동작:
  - du 명령으로 크기 계산
  - MB 단위로 변환

출력:
  - "Directory size: XXX MB"
  - 크기 숫자 반환

실패조건:
  - 디렉터리 없으면 에러
```

### 프로세스 관련

```yaml
기능: 특정 포트의 프로세스 종료

입력:
  - port: 포트 번호

동작:
  - lsof로 포트 사용 프로세스 찾기
  - kill -15 (SIGTERM) 전송
  - 3초 대기
  - 여전히 살아있으면 kill -9 (SIGKILL)

출력:
  - "[SUCCESS] Process on port {port} terminated"

실패조건:
  - 프로세스 없으면 경고만 출력 (에러 아님)
```

### 네트워크 관련

```yaml
기능: 포트 연결 가능 여부 확인

입력:
  - host: 호스트 주소 (기본값: 127.0.0.1)
  - port: 포트 번호
  - timeout: 타임아웃 초 (기본값: 5)

동작:
  - nc 또는 telnet으로 연결 시도
  - timeout 내에 연결되면 성공

출력:
  - 성공: "[SUCCESS] Port {port} is reachable"
  - 실패: "[ERROR] Port {port} is unreachable"

실패조건:
  - timeout 초과하면 에러
```

---

## 🎨 고급 옵션 (필요시만)

복잡한 요구사항이 있다면:

```yaml
기능: [기능명]

입력: [...]
동작: [...]
출력: [...]
실패조건: [...]

추가옵션:
  재시도: yes/no
  재시도횟수: N
  타임아웃: N초
  로깅레벨: INFO/WARN/ERROR
  병렬처리: yes/no

참고사항:
  - 특별히 주의할 점
  - 다른 모듈과의 의존성
```

---

## ✨ 최종 체크리스트

요청 전에 확인:
- [ ] 기능 이름이 명확한가?
- [ ] 필수 입력이 명시되었는가?
- [ ] 동작 순서가 이해 가능한가?
- [ ] 출력이 무엇인지 명확한가?
- [ ] 에러 조건이 정의되었는가?

---

## 📤 제출 방법

이 템플릿을 채워서 다음과 같이 요청하세요:

```
기능 추가 요청:

기능: 백업 파일 정리

입력:
  - backup_dir: 백업 디렉터리
  - days: 보관 일수 (기본값: 7)

동작:
  - backup_dir에서 days일 이전 파일 찾기
  - 찾은 파일들 삭제

출력:
  - 삭제된 파일 개수
  - "[SUCCESS] Cleaned N old backups"

실패조건:
  - backup_dir 없으면 에러
  - days가 0보다 작으면 에러
```

이렇게 주시면 됩니다! 🚀
